// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum AuthRole {
  USER
  ADMIN
  SUPER_ADMIN
  SUPPORT
}

enum ScheduleDay {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum ExpenseEntryType {
  INCOME
  EXPENSE
  TRANSFER
}

enum ExerciseType {
  REPS
  TIME
}

model User {
  id         Int      @id @default(autoincrement())
  uuid       String   @unique @default(uuid())
  email      String   @unique
  phone      String?  @unique
  password   String
  first_name String
  last_name  String
  role       AuthRole
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Routine
  activities     Activity[]
  schedule_slots ScheduleSlot[]

  // Expenses
  expense_accounts ExpenseAccount[]
  expense_entries  ExpenseEntry[]
  categories       ExpenseCategory[]
  subcategories    ExpenseSubcategory[]

  // Gym
  muscle_groups MuscleGroup[]
  exercises     Exercise[]
  workouts      Workout[]

  @@index([email])
  @@index([phone])
  @@index([uuid])
  @@map("users")
}

model Activity {
  id         Int      @id @default(autoincrement())
  uuid       String   @unique @default(uuid())
  user_uuid  String
  name       String
  color      String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user           User           @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade)
  schedule_slots ScheduleSlot[]

  @@index([uuid])
  @@index([user_uuid])
  @@map("activities")
}

model ScheduleSlot {
  id            Int         @id @default(autoincrement())
  uuid          String      @unique @default(uuid())
  user_uuid     String
  activity_uuid String
  day           ScheduleDay
  start_time    String
  end_time      String
  created_at    DateTime    @default(now())
  updated_at    DateTime    @updatedAt

  user     User     @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade)
  activity Activity @relation(fields: [activity_uuid], references: [uuid], onDelete: Cascade)

  @@index([uuid])
  @@index([user_uuid])
  @@index([day])
  @@map("schedule_slots")
}

model ExpenseAccount {
  id         Int      @id @default(autoincrement())
  uuid       String   @unique @default(uuid())
  user_uuid  String
  name       String
  icon       String?
  color      String?
  balance    Decimal  @default(0)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user         User           @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade)
  entries_from ExpenseEntry[] @relation("EntryFromAccount")
  entries_to   ExpenseEntry[] @relation("EntryToAccount")

  @@index([user_uuid])
  @@map("expense_accounts")
}

model ExpenseCategory {
  id         Int      @id @default(autoincrement())
  uuid       String   @unique @default(uuid())
  user_uuid  String?
  name       String
  icon       String?
  color      String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user          User?                @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade)
  subcategories ExpenseSubcategory[]
  entries       ExpenseEntry[]

  @@index([user_uuid])
  @@map("categories")
}

model ExpenseSubcategory {
  id            Int      @id @default(autoincrement())
  uuid          String   @unique @default(uuid())
  user_uuid     String?
  category_uuid String
  name          String
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  user     User?           @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade)
  category ExpenseCategory @relation(fields: [category_uuid], references: [uuid], onDelete: Cascade)
  entries  ExpenseEntry[]

  @@index([category_uuid])
  @@map("subcategories")
}

model ExpenseEntry {
  id                Int              @id @default(autoincrement())
  uuid              String           @unique @default(uuid())
  user_uuid         String
  type              ExpenseEntryType
  amount            Decimal
  description       String?
  from_account_uuid String
  to_account_uuid   String?
  category_uuid     String
  subcategory_uuid  String
  entry_date        DateTime         @default(now())
  created_at        DateTime         @default(now())
  updated_at        DateTime         @updatedAt

  user         User               @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade)
  from_account ExpenseAccount     @relation("EntryFromAccount", fields: [from_account_uuid], references: [uuid], onDelete: Cascade)
  to_account   ExpenseAccount?    @relation("EntryToAccount", fields: [to_account_uuid], references: [uuid], onDelete: Cascade)
  category     ExpenseCategory    @relation(fields: [category_uuid], references: [uuid], onDelete: Cascade)
  subcategory  ExpenseSubcategory @relation(fields: [subcategory_uuid], references: [uuid], onDelete: Cascade)

  @@index([user_uuid])
  @@index([category_uuid])
  @@index([subcategory_uuid])
  @@index([entry_date])
  @@map("expense_entries")
}

model MuscleGroup {
  id         Int      @id @default(autoincrement())
  uuid       String   @unique @default(uuid())
  user_uuid  String?
  name       String
  color      String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user      User?      @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade)
  exercises Exercise[]

  @@index([user_uuid])
  @@map("muscle_groups")
}

model Exercise {
  id                Int          @id @default(autoincrement())
  uuid              String       @unique @default(uuid())
  user_uuid         String?
  muscle_group_uuid String
  name              String
  description       String?
  type              ExerciseType
  created_at        DateTime     @default(now())
  updated_at        DateTime     @updatedAt

  user         User?        @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade)
  muscle_group MuscleGroup  @relation(fields: [muscle_group_uuid], references: [uuid], onDelete: Cascade)
  sets         WorkoutSet[]

  @@index([user_uuid])
  @@index([muscle_group_uuid])
  @@map("exercises")
}

model Workout {
  id          Int      @id @default(autoincrement())
  uuid        String   @unique @default(uuid())
  user_uuid   String?
  name        String?
  notes       String?
  started_at  DateTime @default(now())
  finished_at DateTime @updatedAt
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  user User?        @relation(fields: [user_uuid], references: [uuid], onDelete: Cascade)
  sets WorkoutSet[]

  @@index([user_uuid])
  @@index([started_at])
  @@map("workouts")
}

model WorkoutSet {
  id               Int          @id @default(autoincrement())
  uuid             String       @unique @default(uuid())
  workout_uuid     String
  exercise_uuid    String
  type             ExerciseType
  reps             Int?
  weight           Decimal?
  duration_seconds Int?
  distance_meters  Int?
  reset_seconds    Int?
  notes            String?
  is_dropset       Boolean      @default(false)
  is_amrap         Boolean      @default(false)
  is_rest          Boolean      @default(false)
  is_warmup        Boolean      @default(false)
  is_cooldown      Boolean      @default(false)
  is_super_set     Boolean      @default(false)
  order            Int
  created_at       DateTime     @default(now())
  updated_at       DateTime     @updatedAt

  workout  Workout  @relation(fields: [workout_uuid], references: [uuid], onDelete: Cascade)
  exercise Exercise @relation(fields: [exercise_uuid], references: [uuid], onDelete: Cascade)

  @@map("workout_sets")
}
